#include <stdio.h>
#include <string.h>
#define N 100
struct worker
{
	char gh[10];//*工号
	char xm[10];//*姓名
	float gw;//*岗位工资
	float xj;//*薪级工资
	float zw;//*职务津贴
	float jx;//*绩效工资
	float yf;//*应发工资
	float gr;//*个人所得税
	float sf;//*实发工资
}

int main()
{
    void find(struct worker work[10],int a);//*查询职工信息
    void modify(struct worker work[10],int a);//*修改职工信息
	int add(struct worker work[10],int a);//*添加职工信息
    void del(struct worker work[10],int a);//*删除职工信息
	void write(struct worker work[10],int a);//*保存职工信息
	void list(struct worker work[10],int a);//*浏览职工信息
	struct worker work[N],*p=work;
	int a=N,select;          /*printf("请输入职工人数:");scanf ("%d",&a);*/
	printf("您是首次登陆本系统，请输入员工信息：\n") ;
	a=add(p,a);
	do     //*打印菜单项
	{
		printf("\n **********职工工资管理系统********** \n");
		printf("\n 1.查询职工工资 \n");
		printf("\n 2.修改职工工资 \n");
		printf("\n 3.添加职工工资 \n");
		printf("\n 4.删除职工工资 \n");
		printf("\n 5.保存职工信息 \n");
        printf("\n 6.浏览职工信息 \n");
		printf("\n 0.退出    系统 \n");
		printf("\n ************************************ \n");
		printf("\n 请输入您的选择 \n");
		scanf("%d",&select);
		switch(select)
		{
		case 1:
			find(p,a);
			break;
		case 2:
			modify(p,a);
			break;
		case 3:
			printf("系统已有该职工信息，再次输入将覆盖记录，是否确定（请输入'y'或'n'）");
				getchar();
			if((getchar()=='y')||getchar()=='Y')
				a=add(p,a);
		case 4:
			del(p,a);
			break;
        case 5:
			write(p,a);
			break;
        case 6:
			list(p,a);
			break;    
		case 0:
			printf("要继续操作吗？（请输入'y'或'n'）：");
		}
		getchar();
		if((getchar()=='y')||getchar()=='Y')
			break;
	}
while(1);
printf("职工工资管理系统本次运行结束\n");
	return 0;
}
void read(struct worker work[10],int a)//*读取职工信息
{
    FILE *fp = fopen("gx.dat", "rb");    //定义文件指针
    int i;
    if((fp == NULL))    //打开当前目录下文件
    {
        printf("\n文件打开失败！");
        exit(-1);
    }

    for(i = 0; i < 100; i ++)    //读取文件的数据并存到结构体数组zggz中
    {
        int nRes = fscanf(fp, "%s %s %f %f %f %f %f %f %f",
                  zggz[i].number, zggz[i].name, &zggz[i].gw_salary, 
                  &zggz[i].xj_salary, &zggz[i].subsidy, &zggz[i].jx_salary,
                  &zggz[i].yf_salary, &zggz[i].tax, &zggz[i].actual_wage);
        if (nRes == -1)    //判断是否读取到文件尾部
        {
            n = i;    //记录写入数据的条数
            fclose(fp);
            break;
        }	
    }

    fclose(fp);    //关闭文件
  
}

int write()//*保存职工信息
{
	FILE *fp ;
    fp=fopen("gz.dat" , "wb" );
    if ( fp == NULL )
    {
		return -1 ;
	}
    fwrite( (char*)zggz , sizeof(struct zggz), n , fp ); 
	fclose(fp);
}; 


float grsds(float yfgz)//*计算个人所得税
{
	for(i = 1; i < n+1; i++)
	{
		if(yfgz <= 500)
		{
			return 5;
		}
		else if(yfgz > 500 && yfgz <= 2000)
		{
			return 10;
		}
		else if(yfgz > 2000 && yfgz <= 5000)
		{
			return 15;
		}
		else if(yfgz > 5000 &&yfgz <= 20000)
		{
			return 20;
		}
		else if(yfgz > 20000 && yfgz <= 40000)
		{
			return 25;
		}
		else if(yfgz > 40000 && yfgz <= 60000)
		{
			return  30;
		}else if(yfgz > 60000 && yfgz <= 80000)
		{
			return 35;
		}
		else if(yfgz > 80000 && yfgz <= 100000)
		{
			return 40;
		}else 
		{
			return 45;
		}
	}
}



void find(struct worker work[10],int a)//*查询职工信息
{
}

void modify(struct worker work[10],int a)//*修改职工信息
{
    char gonghao[10], s[10];
    int i, flag = 1;

    printf("\n--------------------修改--------------------\n");
    do
    {
        printf("\n请输入所要重新录入数据的职员工号：");
        scanf("%s", gonghao);
        for(i = 0; i < n; i ++)
        {
            if(strcmp(gonghao, zggz[i].number) == 0)
            {
                printf("\n请录入该职工的工资数据：\n");
                
                printf("\n岗位工资：");    //输入岗位工资
                scanf("%f", &zggz[i].gw_salary);

                printf("\n薪级工资：");    //输入薪级工资
                scanf("%f", &zggz[i].xj_salary);

                printf("\n职务津贴：");    //输入职务津贴
                scanf("%f", &zggz[i].subsidy);

                printf("\n绩效工资：");    //输入绩效工资
                scanf("%f", &zggz[i].jx_salary);

                zggz[i].yf_salary = zggz[i].gw_salary + zggz[i].xj_salary 
                        + zggz[i].subsidy + zggz[i].jx_salary;

                grsds(i);    //计算个人所得税

                zggz[i].actual_wage = zggz[i].yf_salary - zggz[i].tax;

                printf("\n------------------修改结束------------------\n");

                flag = 0;    //控制循环结束
                break;
            }
        }
        if(flag == 1)
        {
            printf("\n无此工号职工信息\n");

            printf("是否放弃修改？是：y 否：n\n");
            scanf("%s", s);
            if(strcmp(s, "y") == 1)
            {
                flag = 0;
            }
            else if(strcmp(s, "n") == 1)
            {
            }
        }
    }while(flag);
}


int add(struct worker work[10],int a)//*添加职工信息
{
}

void del(struct worker work[10],int a)//*删除职工信息
{
}

void list(struct worker work[10],int a)//*浏览职工信息
{
    int i;
    printf("\n--------------浏览职工工资数据--------------\n");
    for(i = 0; i < n; i ++)
    {
        printf("\n职员工号：%s\t\n职员姓名：%s\t\n岗位工资：%.2f\t", 
            zggz[i].number, zggz[i].name, zggz[i].gw_salary);

        printf("\n薪级工资：%.2f\t\n职务津贴：%.2f\t\n绩效工资：%.2f\t", 
            zggz[i].xj_salary, zggz[i].subsidy, zggz[i].jx_salary);

        printf("\n应发工资：%.2f\t\n个人所得税：%.2f\t\n实发工资：%.2f\t\n", 
            zggz[i].yf_salary, zggz[i].tax, zggz[i].actual_wage);
    }
    printf("\n------------------浏览结束------------------\n");
}
